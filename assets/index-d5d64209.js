var O=Object.defineProperty;var T=(o,e,t)=>e in o?O(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>(T(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class r{constructor(e,t="div",n="",s=""){h(this,"node",null);const i=document.createElement(t);i.className=n,i.innerHTML=s,e&&e.insertAdjacentElement("beforeend",i),this.node=i}destroy(){this.node.remove()}}class E extends r{constructor(e,t,n="h1",s="title"){super(e,n,s,t)}}const N=()=>Math.floor(Date.now()*Math.random()),v=(o,e,t)=>{t==="hide"?(o.classList.add("hidden"),o.classList.remove("visible"),e.classList.remove("hidden"),e.classList.add("visible")):(e.classList.add("hidden"),e.classList.remove("visible"),o.classList.remove("hidden"),o.classList.add("visible"))},b=(o,e=t=>t)=>{o.classList.add("animate-remove"),setTimeout(()=>{e()},300)},k=o=>{o.classList.add("animate-enter"),setTimeout(()=>{o.classList.remove("animate-enter")},500)},C=(o,e)=>Math.floor(Math.random()*(e-o+1))+o;class f{constructor(e,t,n){h(this,"node",null);const s=document.createElement("input");s.className=t,Object.entries(n).forEach(([i,a])=>{s.setAttribute(i,a)}),e&&e.append(s),this.node=s}destroy(){this.node.remove()}getValue(){return this.node.value}setValue(e){this.node.value=e}}class m extends r{constructor(e,t,n="",s=""){super(e,"button",t),s&&(this.node.textContent=s),n&&(this.node.innerHTML=n)}}class J extends r{constructor(e,t=n=>n){super(e,"form","form",null,"end"),new E(this.node,"TODO");const n=new f(this.node,"form-input",{placeholder:"Write task ..."});new m(this.node,"form-btn","","ADD"),this.node.addEventListener("submit",s=>{s.preventDefault(),t({id:N(),text:n.getValue()}),n.setValue("")})}}class L extends r{constructor(e,t,n,s=""){super(e,"label","checkbox-container");const i=new f(this.node,"",{type:"checkbox"});s&&i.node.setAttribute("checked","checked"),i.node.addEventListener("change",()=>{b(e,()=>t(e,n))}),new r(this.node,"div","checkbox-checkmark")}}class x extends r{constructor(e,t,n,s,i){super(e,"li","task");const{id:a}=t;let{text:d}=t;this.node.setAttribute("data-id",a),new L(this.node,i,t);const c=new r(this.node,"div","task-text-wrapper"),u=new r(c.node,"p","task-text",d),l=new f(c.node,"task-input hidden",{value:d}),p=new r(this.node,"div","btn-wrapper");new m(p.node,"edit-btn"),new m(p.node,"save-btn"),new m(p.node,"remove-btn").node.addEventListener("click",()=>{b(this.node,()=>n(this.node,a))}),this.node.addEventListener("click",g=>{g.target.className==="edit-btn"&&(v(u.node,l.node,"hide"),l.node.focus()),g.target.className==="save-btn"&&(v(u.node,l.node,""),s({id:a,text:l.getValue()}))})}}class w extends r{constructor(t,n,s,i,a,d){super(t,"div",n);h(this,"list");h(this,"itemsCount");s.subscribe(this);const{state:c}=s;this.itemsCount=c.current.length,this.list=new r(this.node,"ul","task-list"),this.message=new r(null,"p","message","There is no tasks.");const u=c.current;this.itemsCount?u.forEach(l=>new x(this.list.node,l,i,a,d)):this.list.node.append(this.message.node)}signal(t){this.itemsCount=t.current.length,this.itemsCount?this.message.destroy():this.list.node.append(this.message.node)}}class y extends r{constructor(e,t,n,s){super(e,"li","task");const{id:i,text:a}=t;this.node.setAttribute("data-id",i),new L(this.node,s,t,"checked");const d=new r(this.node,"div","task-text-wrapper");new r(d.node,"p","task-text",a);const c=new r(this.node,"div","btn-wrapper");new m(c.node,"remove-btn").node.addEventListener("click",()=>{b(this.node,()=>n(this.node,i))})}}class D extends r{constructor(t,n,s,i,a,d){super(t,"div",n);h(this,"list");h(this,"itemsCount");s.subscribe(this);const{state:c}=s;this.itemsCount=c.current.length,this.list=new r(this.node,"ul","task-list",d),this.message=new r(null,"p","message","There is no completed tasks.");const u=c.current;this.itemsCount?u.forEach(l=>new y(this.list.node,l,i,a)):this.list.node.append(this.message.node)}signal(t){this.itemsCount=t.current.length,this.itemsCount?this.message.destroy():this.list.node.append(this.message.node)}}class S{constructor(e){h(this,"loadJSON",e=>localStorage.getItem(e)?JSON.parse(localStorage.getItem(e)):[]);h(this,"saveJSON",e=>{localStorage.setItem(this.key,JSON.stringify(e)),this.setState()});h(this,"joinJSON",e=>{localStorage.setItem(this.key,JSON.stringify([...this.state.current,e])),this.setState()});h(this,"updateJSON",e=>{const{current:t}=this.state,n=t.filter(s=>s.id!==e);this.saveJSON(n)});h(this,"editJSON",({id:e,text:t})=>{const{current:n}=this.state,s=n.map(i=>(i.id===e&&(i.text=t),i));this.saveJSON(s)});this.key=e,this.state={prev:[],current:this.loadJSON(this.key)},this.subscribers=[]}setState(){this.state.current.length&&(this.state.prev=this.state.current.slice()),this.state.current=this.loadJSON(this.key),this.notify()}subscribe(e){this.subscribers.push(e)}notify(){this.subscribers.forEach(e=>{e.signal(this.state)})}}const A={messages:["Congratulations!","You're on roll!","Amazing!","Good job, sir!","Wow! Perfect!"],duration:4e3,onClose:!1,progressBar:!0};class j extends r{constructor(e,t){super(e,"div","toast"),Object.entries({...A,...t}).forEach(([a,d])=>{this[a]=d});const n=new r(this.node,"button","toast-close-btn","&times;");n.node.onclick=()=>this.destroy();const s=new r(this.node,"div","toast-text-wrapper");if(new r(s.node,"img","toast-img").node.setAttribute("src","/todo-js/confetti.png"),new r(s.node,"span","toast-text",this.messages[C(0,4)]),this.onClose||setTimeout(()=>this.destroy(),this.duration),this.progressBar){const a=new r(this.node,"div","progress-bar"),d=new r(a.node,"div","progress-bar-bg");d.node.style.animation=`progress-animate ${this.duration}ms linear`}}}class B extends r{constructor(e){super(e,"div","app"),this.taskState=new S("tasks"),this.doneState=new S("done-tasks"),this.form=new J(this.node,this.add.bind(this)),this.main=new r(this.node,"main","main"),this.taskList=new w(null,"task-list-wrapper",this.taskState,this.remove.bind(this),this.edit.bind(this),this.done.bind(this)),this.main.node.insertAdjacentElement("afterbegin",this.taskList.node),this.doneTaskList=new D(null,"done-tasks-wrapper",this.doneState,this.removeDoneTask.bind(this),this.restore.bind(this),'<h2 class="done-list-title">Done</h2>'),this.main.node.insertAdjacentElement("beforeend",this.doneTaskList.node)}add(e){this.taskState.joinJSON(e),k(new x(this.taskList.list.node,e,this.remove.bind(this),this.edit.bind(this),this.done.bind(this)).node)}addDone(e){this.doneState.joinJSON(e),k(new y(this.doneTaskList.list.node,e,this.removeDoneTask.bind(this),this.restore.bind(this)).node)}remove(e,t){this.taskState.updateJSON(t),e.remove()}removeDoneTask(e,t){this.doneState.updateJSON(t),e.remove()}edit(e){this.taskState.editJSON(e),this.taskList.destroy(),this.taskList=new w(null,"task-list-wrapper",this.taskState,this.remove.bind(this),this.edit.bind(this),this.done.bind(this)),this.main.node.insertAdjacentElement("afterbegin",this.taskList.node)}done(e,t){const{id:n}=t;this.remove.call(this,e,n),this.addDone(t),new j(this.node)}restore(e,t){const{id:n}=t;this.removeDoneTask(e,n),this.add(t)}}const I=document.getElementById("root");new B(I);
